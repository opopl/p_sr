% vim: keymap=russian-jcukenwin
%%beginhead 
 
%%file man.rc_fmt
%%parent man.errors
 
%%endhead 

\clearpage
\section{FORMAT OF COMMAND SPECIFICATIONS}
  
\vspace{0.5cm}
 {\ifDEBUG\small\LaTeX~section: \verb|man.rc_fmt| project: \verb|latexmk| rootid: \verb|p_saintrussia| \fi}
\vspace{0.5cm}
  

Some of the variables set the commands that latexmk uses  for  carrying out
its  work, for example to generate a \verb|.dvi| file from a \verb|.tex| file
or to view a postscript file.  This section describes some important  features
of how the commands are specified.  (Note that some of the possibilities listed
here do not apply to the \verb|$kpsewhich| variable;  see  its documentation.)

\subsection{Placeholders}

Supposed you wanted latexmk to use the command elatex in place
of the regular latex  command,  and  suppose  moreover  that  you wanted  to
give  it the option \verb|"--shell-escape"|.  You could do this by the
following setting:

\begin{verbatim}
  $latex = 'elatex --shell-escape %O %S';
\end{verbatim}

The two items starting with the \verb|%| character  are  placeholders.   These
are  substituted by appropriate values before the command is run.  Thus
\verb|%S| will be replaced by the source file that elatex will be applied to,
and  %O will be replaced by any options that latexmk has decided to use for
this command.  (E.g., if you used the \verb|-silent| option in the invocation
of  latexmk,   it  results in the replacement of \verb|%O| by
\verb|"-interaction=batchmode"|.)

\index{format!placeholders}
The available placeholders are:

\begin{itemize}

\item \verb|%A| basename of the main tex file.  Unlike \verb|%R|, this is
        unaffected by the setting of a jobname by  the \verb|-jobname| option or the
        \verb|$jobname| configuration value.

\item \verb|%B| base of filename for current command. E.g.,  if  a  postscript
file  \verb|document.ps|  is being made from the dvi file \verb|document.dvi|,
then the basename is \verb|document|.

\item \verb|%D| destination file (e.g., the name of  the  postscript  file  when
converting a dvi file to postscript).

\item \verb|%O| options

\item \verb|%P| If  the  variable \verb|$pre_tex_code| is non-empty, then
        \verb|%P| is substituted  by  the  contents  of  \verb|$pre_tex_code|
        followed  by   \verb|\input{SOURCE}|,  where  SOURCE  stands  for  the
        name of the source file.  Appropriate quoting is done.  This enables
        TeX code to be passed  to  one  of the *latex engines to be executed
        before the source file is read.

If the variable \verb|$pre_tex_code| is the empty string,  then  \verb|%P|  is
equivalent to \verb|%S|.

\item \verb|%R| root filename.  This is the base name for the main tex
        file.

By  default  this is the basename of the main tex file.  However the value can
be changed by the use of the  \verb|-jobname|  option  or the \verb|$jobname|
configuration variable.

\item \verb|%S|     source  file  (e.g.,  the name of the dvi file when converting a
.dvi file to ps).

\item \verb|%T|     The name of the primary tex file.

\item \verb|%U|     If the variable \verb|$pre_tex_code| is non-empty, then
        its  value  is substituted  for \verb|%U| (appropriately quoted).
        Otherwise it is replaced by a null string.

\item \verb|%Y|     Name of directory for auxiliary output files (see the
  configuration variable \verb|$aux_dir|).  A directory separation
  character (\verb|'/'|) is appended if \verb|$aux_dir| is
  non-empty and does not end in a suitable character, with
  suitable characters being those appropriate to UNIX and
  MS-Windows, i.e., \verb|':'|, \verb|'/'| and \verb|'\'|.   Note  that  if after
  initialization,  \verb|$out_dir| is set, but \verb|$aux_dir| is
  not set (i.e., it is blank), then latexmk  sets
  \verb|$aux_dir|  to  the  same value \verb|$out_dir|.

\item \verb|%Z|     Name  of directory for output files (see the configuration
        variable \verb|$out_dir|).  A directory separation character (\verb|'/'|)
        is  appended  if  \verb|$out_dir| is non-empty and does not end in a
        suitable character, with suitable characters being those  appropriate
        to UNIX and MS-Windows, i.e., \verb|':'|, \verb|'/'| and \verb|'\'|.

\end{itemize}

If  for  some  reason you need a literal \verb|%| character in your string not
subject to the above rules, use \verb|"%%"|.

Appropriate quoting will be applied to the filename  substitutions,  so
you  mustn't  supply them yourself even if the names of your files have
spaces in them.  (But if your TeX filenames have spaces in them, beware
that  some  older  versions  of the TeX program cannot correctly handle
filenames containing spaces.)  In case latexmk's quoting does not  work
correctly  on your system, you can turn it off --- see the documentation
for the variable \verb|$quote_filenames|.

The distinction between \verb|%B| and \verb|%R| needs a bit of care, since  they  are
often  the same, but not always.  For example on a simple document, the
basename of a bibtex run is the same as for the texfile.  But in a document
with  several bibliographies, the bibliography files will have a variety of
names.  Since \verb|bibtex| is invoked with  the  basename  of  the bibliography
file, the setting for the bibtex command should therefore be

\begin{verbatim}
  $bibtex = 'bibtex %O %B';
\end{verbatim}

Generally, you should use \verb|%B| rather than \verb|%R|.  Similarly for  most
purposes, the name \verb|%T| of the primary texfile is not a useful placeholder.

See  the default values in the section "List of configuration variables usable
in initialization files" for what is normally the most appropriate usage.

If you omit to supply any placeholders whatever in the specification of a
command, latexmk will supply what its author thinks  are  appropriate defaults.
This gives compatibility with configuration files for previous versions of
latexmk, which didn't use placeholders.

"Detaching" a command: Normally when latexmk runs a command,  it  waits
for the command to run to completion.  This is appropriate for commands
like latex, of course.  But for previewers, the command should normally run
detached,  so that latexmk gets the previewer running and then returns to its
next task (or exits if there is nothing else to  do).   To achieve  this
effect  of  detaching a command, you need to precede the command name with
\verb|"start "|, as in

\begin{verbatim}
  $dvi_previewer = 'start xdvi %O %S';
\end{verbatim}

This will be translated to whatever is appropriate for  your  operating
system.

\paragraph{Notes}

\begin{itemize}
  \item (1) In some circumstances, latexmk will always run a command detached.  This
is the case for a previewer in preview  continuous  mode, since  otherwise
previewing continuously makes no sense.  

  \item (2) This precludes the possibility of running a command named start.   

  \item (3)  If  the word  start  occurs  more  than  once  at  the beginning
          of the command string, that is equivalent to having just one.  

  \item (4) Under cygwin,  some complications  happen, since cygwin amounts to a
        complicated merging of UNIX and MS-Windows.  See the source code  for
        how  I've  handled  the problem.
\end{itemize}

Command names containing spaces: Under MS-Windows it is common that the
name of a command includes spaces, since software is often installed in a
subdirectory of \verb|"C:\Program Files"|.  Such command names should be
enclosed in double quotes, as in

\begin{verbatim}
  $lpr_pdf  =  '"c:/Program  Files/Ghostgum/gsview/gsview32.exe"  /p %S';
  
  $pdf_previewer   =   'start   "c:/Program   Files/SumatraPDF/SumatraPDF.exe" %O %S';
  $pdf_previewer = 'start "c:/Program  Files/SumatraPDF  (x86)/SumatraPDF.exe" %O %S';
\end{verbatim}


(Note  about  the  above  example: Under MS-Windows forward slashes are
equivalent to backslashes in a filename under almost all circumstances,
provided  that  the  filename is inside double quotes.  It is easier to
use forward slashes in examples like the one above, since then one does
not  have  to worry about the rules for dealing with forward slashes in
strings in the Perl language.)

Command names under Cygwin: If latexmk is executed  by  Cygwin's  Perl,
be particularly certain that pathnames in commands have forward slashes
not the usual backslashes for the  separator  of  pathname  components.
See  the  above  examples.  Backslashes often get misinterpreted by the
Unix shell used by Cygwin's Perl to execute external commands.  Forward
slashes don't suffer from this problem, and (when quoted, as above) are
equally acceptable to MS-Windows.

Using MS-Windows file associations: A useful trick  under  modern  ver-
sions of MS-Windows (e.g., WinXP) is to use just the command 'start' by
itself:

\begin{verbatim}
  $dvi_previewer = 'start %S';
\end{verbatim}

Under MS-Windows, this will cause to be run whatever program the system
has  associated  with  dvi  files.   (The same applies for a postscript
viewer and a pdf viewer.)  But note that this trick is not always suit-
able  for the pdf previwer, if your system has acroread for the default
pdf viewer.  As explained elsewhere, acroread under MS-Windows does not
work well with latex and latexmk, because acroread locks the pdf file.

Not using a certain command: If a command is not to be run, the command
name NONE is used, as in

\begin{verbatim}
  $lpr  = 'NONE lpr';
\end{verbatim}

This typically is used when an appropriate command does  not  exist  on
your system.  The string after the "NONE" is effectively a comment.

Options to commands: Setting the name of a command can be used not only
for changing the name of the command called, but also to add options to
command.   Suppose  you  want latexmk to use latex with source specials
enabled.  Then you might use the following line  in  an  initialization
file:

\begin{verbatim}
  $latex = 'latex --src-specials %O %S';
\end{verbatim}

Running  a  subroutine instead of an external command: Use a specification
starting with "internal", as in

\begin{verbatim}
  $latex = 'internal mylatex %O %S';
  sub mylatex {
    my @args = @_;
    # Possible preprocessing here
    return system 'latex', @args;
  }
\end{verbatim}

For some of the more exotic possibilities that then  become  available, see
the  section "ADVANCED CONFIGURATION: Some extra resources and advanced
tricks". Also see some of the examples in  the  directory  \verb|example_rcfiles| in
the latexmk distribution.

Advanced  tricks:  Normally one specifies a single command for the commands
invoked by latexmk.  Naturally, if there is some complicated  additional
processing  you need to do in your special situation, you can write a script
(or batch file) to do the processing, and then configure latexmk to use your
script in place of the standard program.

You  can  also  use a Perl subroutine instead of a script --- see above.
This is generally the most flexible and portable solution.

It is also possible to configure latexmk to run multiple commands.  For
example,  if  when  running  pdflatex to generate a pdf file from a tex
file you need to run another program after pdflatex to perform some ex-
tra processing, you could do something like:

\begin{verbatim}
  $pdflatex  =  'pdflatex  --shell-escape %O %S; pst2pdf_for_latexmk %B';
\end{verbatim}

This definition assumes you are using a  UNIX-like  system  (which  in-
cludes  Linux  and  OS-X), so that the two commands to be run are sepa-
rated by the semicolon in the middle of the string.

If you are using MS-Windows, you would replace the above line by

\begin{verbatim}
  $pdflatex = 'cmd /c pdflatex --shell-escape %O %S' . '&& pst2pdf_for_latexmk %B';
\end{verbatim}

Here, the UNIX command separator ; is replaced  by  \verb|&&|.   In  addition,
there is a problem that some versions of Perl on MS-Windows do not obey
the command separator; this problem is overcome by explicitly  invoking
the MS-Windows command-line processor cmd.exe.

