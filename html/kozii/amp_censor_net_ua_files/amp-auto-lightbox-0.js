(self.AMP=self.AMP||[]).push({n:"amp-auto-lightbox",v:"2007102309001",f:(function(AMP,_){
function l(a){for(var b=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global],c=0;c<b.length;++c){var g=b[c];if(g&&g.Math==Math)return}(function(){throw Error("Cannot find global object");})()}l(this);"function"===typeof Symbol&&Symbol("x");var n;function p(){var a,b;this.promise=new Promise(function(c,g){a=c;b=g});this.resolve=a;this.reject=b};function q(a,b){b=void 0===b?"":b;try{return decodeURIComponent(a)}catch(c){return b}};var r=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function t(a){return a?Array.prototype.slice.call(a):[]};var u=self.AMP_CONFIG||{},v=("string"==typeof u.cdnProxyRegex?new RegExp(u.cdnProxyRegex):u.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function w(a){if(self.document&&self.document.head&&(!self.location||!v.test(self.location.origin))){var b=self.document.head.querySelector('meta[name="'+a+'"]');b&&b.getAttribute("content")}}u.cdnUrl||w("runtime-host");u.geoApiUrl||w("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var x=self.__AMP_LOG;function y(){if(x.dev)return x.dev;throw Error("failed to call initLogConstructor");};var z=Object.prototype.hasOwnProperty;(function(a){return a||{}})({c:!0,v:!0,a:!0,ad:!0,action:!0});function A(a){if(a.__AMP__EXPERIMENT_TOGGLES)return a.__AMP__EXPERIMENT_TOGGLES;a.__AMP__EXPERIMENT_TOGGLES=Object.create(null);var b=a.__AMP__EXPERIMENT_TOGGLES;if(a.AMP_CONFIG)for(var c in a.AMP_CONFIG){var g=a.AMP_CONFIG[c];"number"===typeof g&&0<=g&&1>=g&&(b[c]=Math.random()<g)}if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-doc-opt-in"])&&0<a.AMP_CONFIG["allow-doc-opt-in"].length){var h=a.AMP_CONFIG["allow-doc-opt-in"],k=a.document.head.querySelector('meta[name="amp-experiments-opt-in"]');
if(k){var e=k.getAttribute("content").split(",");for(c=0;c<e.length;c++)-1!=h.indexOf(e[c])&&(b[e[c]]=!0)}}Object.assign(b,B(a));if(a.AMP_CONFIG&&Array.isArray(a.AMP_CONFIG["allow-url-opt-in"])&&0<a.AMP_CONFIG["allow-url-opt-in"].length){c=a.AMP_CONFIG["allow-url-opt-in"];var f=a.location.originalHash||a.location.hash;a=Object.create(null);if(f)for(var d;d=r.exec(f);){var m=q(d[1],d[1]);d=d[2]?q(d[2].replace(/\+/g," "),d[2]):"";a[m]=d}for(f=0;f<c.length;f++)m=a["e-"+c[f]],"1"==m&&(b[c[f]]=!0),"0"==
m&&(b[c[f]]=!1)}return b}function B(a){var b="";try{"localStorage"in a&&(b=a.localStorage.getItem("amp-experiment-toggles"))}catch(h){y().warn("EXPERIMENTS","Failed to retrieve experiments from localStorage.")}var c=b?b.split(/\s*,\s*/g):[];a=Object.create(null);for(var g=0;g<c.length;g++)0!=c[g].length&&("-"==c[g][0]?a[c[g].substr(1)]=!1:a[c[g]]=!0);return a};var C=[{experimentId:"ampdoc-fie",isTrafficEligible:function(){return!0},branches:["21065001","21065002"]}];function D(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return E(a,b)}function F(a,b){var c=G(a);c=H(c);return E(c,b)}function G(a){return a.nodeType?D((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function H(a){a=G(a);return a.isSingleDoc()?a.win:a}function E(a,b){I(a,b);var c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}
function I(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor&&!a.obj)};/*
 https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function J(a,b){for(;a&&void 0!==a;a=a.parentElement)if(b(a))return a;return null}
function K(a){return a.closest?a.closest("a[href],amp-script,amp-story,button,amp-lightbox,amp-carousel,[placeholder],[data-amp-auto-lightbox-disable],amp-selector [option],[subscriptions-action]"):J(a,function(a){var b=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;return b?b.call(a,"a[href],amp-script,amp-story,button,amp-lightbox,amp-carousel,[placeholder],[data-amp-auto-lightbox-disable],amp-selector [option],[subscriptions-action]"):!1})}
function L(a){var b=a.tagName;4>b.length||b.lastIndexOf("AMP-",0);if(a.createdCallback)return Promise.resolve(a);a.__AMP_UPG_PRM||(b=new p,a.__AMP_UPG_PRM=b.promise,a.__AMP_UPG_RES=b.resolve);return a.__AMP_UPG_PRM};/nochunking=1/.test(self.location.hash);(function(){return n?n:n=Promise.resolve(void 0)})();var M={Article:!0,NewsArticle:!0,BlogPosting:!0,LiveBlogPosting:!0,DiscussionForumPosting:!0};function N(){}var O=/\s+([0-9]+)w(,|[\S\s]*$)/g;function P(a){return F(a,"mutator").mutateElement(a,function(){a.setAttribute("i-amphtml-auto-lightbox-visited","")})}function Q(a){return L(a).then(function(a){return a.signals().whenSignal("load-end")})}
function R(a){return t(a.getRootNode().querySelectorAll('script[type="application/ld+json"]')).map(function(a){try{var b=JSON.parse(a.textContent)}catch(g){b=null}return(b||{})["@type"]}).filter(function(a){return a})}function S(a){return R(a).some(function(a){return M[a]})}function T(a){function b(b){return!!a.getRootNode().querySelector(b)}return b('script[custom-element="amp-lightbox-gallery"]')&&b("[lightbox]:not([i-amphtml-auto-lightbox-visited])")}var U=0;
function V(a,b){return F(a,"mutator").mutateElement(b,function(){b.setAttribute("lightbox","i-amphtml-auto-lightbox-"+U++)}).then(function(){D(a.win,"extensions").installExtensionForDoc(a,"amp-lightbox-gallery");b.dispatchCustomEvent("amp-auto-lightbox:newly-set");return b})}
function W(a,b){b.map(function(b){return Q(b).then(function(){var c;if(c=!b.signals().get("unload")){var h=b.querySelector("img");c=h.naturalWidth;var k=h.naturalHeight;var e=c/k;var f=-1;if(h=h.getAttribute("srcset"))for(var d;d=O.exec(h);)d=parseInt(d[1],10),d>f&&(f=d);k=f>c?{naturalWidth:f,naturalHeight:f/e}:{naturalWidth:c,naturalHeight:k};c=k.naturalWidth;k=k.naturalHeight;f=b.getLayoutBox();e=f.width;h=f.height;d=F(b,"viewport").getSize();f=d.width;d=d.height;e*=h;if(c=1.2<=c*k/e||c>f||k>d||
.25<=e/(f*d))if(K(b))c=!1;else{c=b.ownerDocument.defaultView;e=c.__AMP_TOP||(c.__AMP_TOP=c);k=c!=e;if(A(e)["ampdoc-fie"]){e.__AMP_EXPERIMENT_BRANCHES=e.__AMP_EXPERIMENT_BRANCHES||{};for(f=0;f<C.length;f++)d=C[f],h=d.experimentId,z.call(e.__AMP_EXPERIMENT_BRANCHES,h)||(d.isTrafficEligible&&d.isTrafficEligible(e)?!e.__AMP_EXPERIMENT_BRANCHES[h]&&A(e)[h]&&(d=d.branches,e.__AMP_EXPERIMENT_BRANCHES[h]=d[Math.floor(Math.random()*d.length)]||null):e.__AMP_EXPERIMENT_BRANCHES[h]=null);e="21065002"===(e.__AMP_EXPERIMENT_BRANCHES?
e.__AMP_EXPERIMENT_BRANCHES["ampdoc-fie"]:null)}else e=!1;k&&!e?c=I(c,"action")?E(c,"action"):null:(c=G(b),c=H(c),c=I(c,"action")?E(c,"action"):null);c=!c.hasResolvableAction(b,"tap")}}if(c)return y().info("amp-auto-lightbox","apply",b),V(a,b)},N)})}
function X(a,b){if(T(a))var c=0;else c=(c=a.getRootNode().querySelector('meta[property="og:type"]'))?c.getAttribute("content"):void 0,c="article"==c||S(a);c?(c=t((b||a.win.document).querySelectorAll("amp-img:not([lightbox]):not([i-amphtml-auto-lightbox-visited])")),c.forEach(P),W(a,c)):y().info("amp-auto-lightbox","disabled")}(function(a){var b=a.ampdoc;b.whenReady().then(function(){b.getRootNode().addEventListener("amp:dom-update",function(a){X(b,a.target)});X(b)})})(self.AMP);
})});

//# sourceMappingURL=amp-auto-lightbox-0.1.js.map
