
vars:
  img_root: '@env{IMG_ROOT}'

targets:
  exclude:
  include:
  - '_all_'
#    - usual
    #- nov_2020
    #- dec_2020
    #- poetry
    #- writers
    #- leontovych_mykola
    #- titlepage
    #- ki
    #

run_tex:
  shell: capture

tex4ht:
  run:
    #exe: make4ht
    exe : htlatex
    argc:
      tex4ht:
      t4ht:
      latex: '-file-line-error'

plans:
  vars:
     sec: '29_11_2022'
     #date: '24_11_2022'
     #auth: 'filatov_boris'
     #out: 'htx'
     out: 'pdf'
     seq:
       limit: 2
  dry: 1
  rw: 1
  #dmp: 1
  seq:
  - 'compile.$var{out}.buf.$var{sec}'

  #- 'compile.htx.auth.$var{auth}'
  #- { 'vars.out' : 'htx' }

  #- 'compile.htx.buf.24_11_2022.fb.filatov_boris.2.nastroenia_v_gorode'
  #- 'compile.htx.buf.$var{date}'
  #- 'compile.htx.auth.shablivska_viktoria'
  #- 'compile.pdf.buf.24_11_2022.fb.filatov_boris.2.nastroenia_v_gorode'
  #- 'compile.pdf.buf.+':
    #- 09_08_2021.fb.filatov_boris.1.devochka_maguchih
    #'compile.htx.buf.': 

  define:
  - 'compile.htx.buf.24_11_2022':
      'do_children' : 0

  - '^compile\.pdf\.':
      'target_ext' : 'pdf'

  - '^compile\.htx\.':
      'target_ext' : 'html'
      'do_htlatex' : 1

  - '^compile\.pdf\.buf\.(?<sec>\S+)$':
      'argv' : 'compile -t _buf.$+{sec}'

  - '^compile\.htx\.buf\.(?<sec>\S+)$':
      'argv' : 'compile -c htx -t _buf.$+{sec}'

  - '^compile\.htx\.auth\.(?<author_id>\S+)$':
      'argv' : 'compile -c htx -t _auth.$+{author_id}'
      'target_ext' : 'pdf'
      'do_children' : 1
      'pref_ci' : 'compile.htx.buf.'

  - '^compile.htx\.buf\.(?<sec>(\d+)_(\d+)_(\d+))$':
      'do_children' : 1


#  define:
   #'^htx\.buf\.(\S+)$':
      #'argv' : 'compile -c htx -t _buf.$1'

   #'^htx\.buf\.(\d+)_(\d+)_(\d+)$':
      #'do_children' : 1
